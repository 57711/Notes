# 上下文/预编译

## 上下文

- 全局上下文创建阶段
  1. window 作为全局上下文对象
  2. 设置 this 指向 window
  3. 声明变量和函数，安排内存空间
  4. var 变量赋值 undefined
  5. 防区作用域链
- 全局上下文执行阶段
  一行行执行，遇到函数创建 函数上下文
- 函数上下文创建
  1. arguments 作为上下文
  2. this 指向函数调用
  3. 函数上下文执行之后从作用域链弹出
  4. 每次调用函数都创建函数上下文

## 预编译

### 全局预编译

1. 创建全局上下文对象，window；
2. 变量声明提前，var 变量赋值为 undefined，let 声明的不初始化
3. 函数声明提前，函数会覆盖相同的变量名。
4. 预编译结束，开始执行第一行代码。

```js
console.log(test); //输出 function test() {};
var test = 100;
console.log(test); //输出 100;
function test() {
  console.log(111);
}
console.log(test); //输出 100;
```

### 函数预编译

1. 创建函数上下文
2. 找形参，变量声明，赋值 undefined
3. 实参，形参相统一
4. 函数声明，赋值函数体
5. 从开始执行

```js
function test1(a) {
  console.log(b); //1  输出 function b(){}
  var b = 0;
  console.log(b); //2  输出 0
  console.log(a); //3  输出 function a(){}
  function a() {}
  function b() {}
}
test1(1);
// 1. 创建函数上下文
// 2. 找形参和变量声明， a: undefined, b: undefined
// 3. 带入实参，a: 1, b: undefined
// 4. 函数声明，a: fn, b: fn
```

### 总结

- 同名变量， 采用先声明的
- 同名函数， 采用后声明的
- 同名函数和变量， 采用函数

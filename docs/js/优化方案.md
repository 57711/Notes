# 优化方案

优化第一步是确定指标。

- 业务优化，收益最大的功能先优化
- 结构优化 (编码之前)

  - 开发流程优化
    - **设计更重要**，代码之前的优化，先设计并 review，设计包括
      - 功能目标
      - 需要的设计
      - 需要的组件，逻辑关系
      - 需要的数据接口
    - 代码注释，模块
    - 结偶，避免代码过度集中
    - ts 看情况用，ui 层面慎用
  - 设计优化，ui 统一

- [技术优化](/frontend/%E4%BC%98%E5%8C%96.html)(代码层面，前端性能瓶颈)
  - 加载，
    - 少请求，小体积
      - 压缩合并文件，减少请求数
        - splitChunk 合并 css，js，
        - 图片用 Data URI scheme，base64 直接嵌入 html/css `data:;base64,...`
        - 同域下的 js 下载合并，用逗号`<sctipt src="//b.com/a.js,b.js">`
      - CDN 静态服务器，加速静态资源
      - [nginx 配置 gzip](/frontend/nginx.html#开启-gzip)
    - 多缓存
      - http2
        - 缓存：http stream 中 push 进额外的 js，请求一个 html 会同时下载额外的 js，页面需要 js 时走缓存
        - [nginx 配置开启 http2](<(/frontend/nginx.html#开启-http2)>)
        - tcp 浏览器连接个数限制，可以多域名
      - DNS 缓存
        浏览器，操作系统，局域网，ISP 都会有 DNS 缓存
    - 预加载
      - 利用空闲时间加载.
      - 新业务上线前预加载，使新业务有缓存。
    - 懒加载
      - DOM 和 js 可以先隐藏元素，或者用不会渲染的元素`<script type="非脚本">`
      - 图片可以懒加载，滚动事件

::: tip Base64 大小变化
base64 字符 a-zA-Z0-9+/ 共 64 个，二进制用 6 位表示

1. 字符串转为 ascii 的二进制，每个字符 8 位
2. 重新划分 6 位为一组，不够 6 位后面补 0，每组前面再补两位 0，得到 8 位
3. 从 a-zA-Z0-9+/中找到字符。

所以 base64 转换后变大 1/3
:::
